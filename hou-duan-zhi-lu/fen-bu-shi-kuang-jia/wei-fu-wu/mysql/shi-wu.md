# 事务

### 一.简介

事务是一组操作的集合，这些操作要么同时成功，要么同时失败。

### 二.开启事务

开启事务如下两种方式：

```sql
# 方式1
START TRANSACTION;
# 方式2
BEGIN;
```

如果事务里的sql都执行成功，可以使用commit提交：

```sql
COMMIT;
```

如果发现有sql执行失败，可以使用rollback回滚：

```sql
ROLLBACK;
```

注意：

* start transaction和begin的本质是将系统变量autocommit设置为禁用状态，直到使用commit或rollback结束事务，系统变量autocommit才会变回原本的状态。
* 系统变量autocommit默认是启用的，此时每条sql语句都可以看作一条事务，其提交和回滚由数据库自己控制。

### 三.四大特性ACID

* 原子性（Atomicity）：事务是不可分割的最小操作单元，要么全部成功，要么全部失败。
* 一致性（Consistency）：事务完成时，必须使所有的数据都保持一致状态。
* 隔离性（Isolation）：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立 环境下运行。
* 持久性（Durability）：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。

### 四.并发事务问题

* 脏读：一个事务读到另外一个事务还没有提交的数据。
* 不可重复读：一个事务先后读取同一条记录，但两次读取的数据不同，称之为不可重复读。
* 幻读：一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据 已经存在，好像出现了 "幻影"。

### 五.事务隔离级别

事务隔离级别从弱到强如下所示：

* Read uncommitted：存在脏读、不可重复读、幻读的问题。
* Read committed：存在不可重复读、幻读的问题。
* Repeatable Read：存在幻读问题。
* Serializable：操作是串行的，不存在并发事务问题。

MySQL中默认的隔离级别是Repeatable Read。
